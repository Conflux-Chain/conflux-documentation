---
displayed_sidebar: generalSidebar
---

# é€šè¿‡å‡å°‘éé›¶å­—èŠ‚æ¥é™ä½ç‡ƒæ°”è´¹ç”¨

When optimizing gas usage in smart contracts, it's crucial to consider every aspect of data representation. æœ‰ä¸€ç§å¸¸è¢«å¿½è§†çš„ä¼˜åŒ–æŠ€æœ¯æ˜¯åœ¨å¯èƒ½çš„æƒ…å†µä¸‹é¿å…åœ¨ calldata ä¸­ä½¿ç”¨æœ‰ç¬¦å·æ•´æ•°ã€‚ è¿™ç§æ–¹æ³•å¯ä»¥åœ¨å¤„ç†å°çš„è´Ÿæ•°æ—¶èŠ‚çœç‡ƒæ°”è´¹ç”¨ã€‚

ä»¥å¤ªåŠå¯¹é›¶å­—èŠ‚çš„calldataæ”¶å–`4`ä¸ªç‡ƒæ°”è´¹ç”¨ï¼Œè€Œå¯¹éé›¶å­—èŠ‚æ”¶å–`16`ä¸ªç‡ƒæ°”è´¹ç”¨ã€‚ è¿™ç§å®šä»·æ¨¡å¼é€‚ç”¨äºå‡½æ•°è°ƒç”¨ã€‚ å› æ­¤ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä½¿ç”¨æ— ç¬¦å·æ•´æ•°è€Œéæœ‰ç¬¦å·æ•´æ•°å¯ä»¥èŠ‚çœç‡ƒæ°”è´¹ç”¨ã€‚

**è¦ç‚¹:**

- Solidity ä½¿ç”¨äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°ã€‚
- åœ¨äºŒè¿›åˆ¶è¡¥ç å½¢å¼ä¸­ï¼Œå°çš„è´Ÿæ•°ä¸»è¦ç”±éé›¶å­—èŠ‚ç»„æˆã€‚
- åœ¨ calldata ä¸­ä½¿ç”¨æ— ç¬¦å·æ•´æ•°å¯ä»¥å¯¼è‡´æ›´å¤šçš„é›¶å­—èŠ‚ï¼Œä»è€Œé™ä½ç‡ƒæ°”æˆæœ¬ã€‚

**ä¾‹å¦‚:**
æ•°å­— `-1`åœ¨äºŒè¿›åˆ¶è¡¥ç ä¸­è¡¨ç¤ºä¸º`0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff` (256 ä½)ã€‚

### Understanding Two's Complement

äºŒè¿›åˆ¶è¡¥ç æ˜¯ä¸€ç§ç”¨äºåœ¨äºŒè¿›åˆ¶ä¸­è¡¨ç¤ºå¸¦ç¬¦å·æ•´æ•°çš„æ•°å­¦è¿ç®—ã€‚ åœ¨è¯¥ç³»ç»Ÿä¸­ï¼Œè´Ÿæ•°æ˜¯é€šè¿‡åè½¬æ­£æ•°çš„æ‰€æœ‰ä½å¹¶åŠ 1æ¥è¡¨ç¤ºçš„ã€‚

**äºŒè¿›åˆ¶è¡¥ç ç¤ºä¾‹:**

| åè¿›åˆ¶  | 8 ä½äºŒè¿›åˆ¶(æ— ç¬¦å·æ•°) | 8 ä½äºŒè¿›åˆ¶(å¸¦ç¬¦å·æ•°ï¼ŒäºŒè¿›åˆ¶è¡¥ç ) |
| ---- | ------------------------------- | ------------------------------------- |
| 1    | 00000001                        | 00000001                              |
| -1   | N/A                             | 11111111                              |
| 127  | 01111111                        | 01111111                              |
| -128 | N/A                             | 10000000                              |

### Gas Savings Analysis

Let's compare the gas costs for using signed vs. unsigned integers in calldata:

| åœºæ™¯                              | ç‡ƒæ°”æ¶ˆè€—                                                                                            | æ€»ç‡ƒæ°”     |
| ------------------------------- | ----------------------------------------------------------------------------------------------- | ------- |
| ä½¿ç”¨å¸¦ç¬¦å·æ•´æ•° (-1) | 32 non-zero bytes (32 Ã— 16 gas)                                              | 512 gas |
| ä½¿ç”¨æ— ç¬¦å·æ•´æ•° (1)  | 31 zero bytes (31 Ã— 4 gas) + 1 non-zero byte (1 Ã— 16 gas) | 140 gas |

### å®ç°ä¼˜åŒ–

ä¸‹é¢æ˜¯å¦‚ä½•åœ¨æ™ºèƒ½åˆçº¦ä¸­å®ç°è¿™ä¸ªä¼˜åŒ–çš„ç¤ºä¾‹ï¼š

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract OptimizedContract {
    // Less efficient for negative numbers
    function processSignedInteger(int256 value) external pure returns (int256) {
        return value * 2;
    }

    // More efficient, especially for small numbers
    function processUnsignedInteger(uint256 value) external pure returns (uint256) {
        return value * 2;
    }

    // If negative values are necessary, consider offsetting
    function processOffsetInteger(uint256 value) external pure returns (int256) {
        // Assuming the range is -128 to 127
        require(value <= 255, "Value out of range");
        return int256(value) - 128;
    }
}
```

### ç‡ƒæ°”ä¼˜åŒ–å»ºè®®

ğŸŒŸ åœ¨è®¾è®¡æ¥å—æ•´æ•°å‚æ•°çš„å‡½æ•°æ—¶ï¼š

1. å°½å¯èƒ½ä½¿ç”¨æ— ç¬¦å·æ•´æ•° (`uint`)è€Œä¸æ˜¯æœ‰ç¬¦å·æ•´æ•° (`int`) ã€‚
2. å¦‚æœå¿…é¡»ä½¿ç”¨è´Ÿæ•°ï¼Œè€ƒè™‘ä½¿ç”¨åç§»é‡æ–¹æ³•ï¼Œé€šè¿‡æ— ç¬¦å·æ•´æ•°è¡¨ç¤ºå€¼çš„èŒƒå›´ï¼Œå¹¶åœ¨åˆçº¦é€»è¾‘ä¸­åº”ç”¨åç§»é‡ã€‚
3. è¯·æ³¨æ„æƒè¡¡åˆ©å¼Šï¼šè™½ç„¶è¿™ä¸ªä¼˜åŒ–å¯ä»¥èŠ‚çœç‡ƒæ°”ï¼Œä½†å®ƒå¯èƒ½ä¼šä½¿åˆçº¦çš„ä½¿ç”¨å˜å¾—ä¸é‚£ä¹ˆç›´è§‚ï¼Œå¹¶ä¸”éœ€è¦é¢å¤–çš„æ–‡æ¡£è¯´æ˜ã€‚

**å®‰å…¨æç¤º**: åœ¨å®ç°æ­¤ä¼˜åŒ–æ—¶ï¼Œç¡®ä¿ä½ çš„åˆçº¦é€»è¾‘èƒ½å¤Ÿæ­£ç¡®å¤„ç†æ‰€æœ‰é¢„æœŸå€¼çš„èŒƒå›´ã€‚ ä¸å½“ä½¿ç”¨æ— ç¬¦å·æ•´æ•°æˆ–åç§»é‡è¡¨ç¤ºæ³•ï¼Œå¦‚æœä¸è®¤çœŸç®¡ç†ï¼Œå¯èƒ½å¯¼è‡´ä¸‹æº¢æˆ–æº¢å‡ºé—®é¢˜ã€‚
